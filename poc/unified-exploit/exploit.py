#!/usr/bin/python3

import random_crack_api as rc
import re
import ast
import json
import sys

# Modulus
N = 1000000000

bodies = []

# Parse responses
with open('response.txt','r') as f:
  stream = False
  body = False
  body_info = {}
  stream_id = -1
  stream_pattern = r"#- *Stream ID: (\d+) *-#"
  for line in f:
    m = re.search(stream_pattern,line.strip())
    if m:
      stream = True
      stream_id = int(m.group(1))
    else:
      if stream:
        if line.strip() == "-Body-":
          body = True
        else:
          if body:
            body_info = json.loads(ast.literal_eval(line.strip()))
            bodies.append((body_info["seq"],body_info["correctNumber"]))
            stream = False
          body = False

# Sort by sequence number
bodies.sort()

input_data = []

# Subtract 1 since server adds 1
for i in range(int(sys.argv[1])):
  input_data.append(bodies[i][1] - 1)

P = rc.Predictor()

P.feed_scaled_floors(input_data,N)
if (P.check_sat()):
  print(P.predict_next_scaled_floor(N))
  exit(0)
else:
  exit(1)